<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.awslabplatform_admin.dao.mechanismManage.MechanismDao">
	<resultMap type="com.awslabplatform_admin.entity.Mechanism" id="MechanismMap">
		<result property="mechanismId" column="mechanismId"/>
		<result property="mechanismName" column="mechanismName"/>
		<result property="mechanismdDescribe" column="mechanismdDescribe"/>
		<result property="mechanismPid" column="mechanismPid"/>
		<result property="mechanismSort" column="mechanismSort"/>
		<result property="createTime" column="createTime"/>
	</resultMap>

 	<!-- 查询机构表数据用来树的显示 author:czy -->
	<select id="getMechanismList" parameterType="String" resultMap="MechanismMap">
		SELECT
			tb_mechanism.mechanismId,tb_mechanism.mechanismName,tb_mechanism.mechanismdDescribe,
			tb_mechanism.mechanismPid,tb_mechanism.mechanismSort,tb_mechanism.createTime
		FROM
			tb_mechanism
		<where>
			1=1
			<if test="department!=null and department!=''" >
				AND FIND_IN_SET(mechanismId,getChildrenList(#{department}))
			</if>
		</where>	
		
	</select>

	<!-- 查询机构名称是否已经存在 author:czy -->
	<select id="countMechanismData" parameterType="Mechanism" resultType="int">
		SELECT
			COUNT(*)
		FROM
			tb_mechanism
		<where>
			1 = 1
			<if test="mechanismName != null">
				AND mechanismName = #{mechanismName}
			</if>
			<if test="mechanismPid != null">
				AND mechanismPid = #{mechanismPid}
			</if>
		</where>
	</select>

	<!-- 插入机构名称的数据 author:czy -->
	<insert id="insert" parameterType="Mechanism">
       INSERT INTO tb_mechanism(
	       	mechanismId,mechanismName,mechanismdDescribe,mechanismPid,createTime)
       VALUES (
           #{mechanismId},#{mechanismName},#{mechanismdDescribe},#{mechanismPid},#{createTime})
	</insert>

	<!-- 删除机构名称数据，将数据传到数据库进行删除对应的数据 -->
    <delete id="deleteMechanismData" parameterType="String" >
   		DELETE FROM tb_mechanism WHERE mechanismId =#{mechanismId}
  	</delete>

  	<!-- 根据mechanismId查询机构数据 author:czy -->
	<select id="getMechanismData" parameterType="java.lang.String" resultType="Mechanism">
		SELECT
			mechanismId,mechanismName,mechanismdDescribe,mechanismPid,createTime
		FROM
			tb_mechanism
		where
			mechanismId = #{mechanismId}
	</select>

  	<!-- 修改机构的数据 author:czy -->
	<update id="updateByPrimaryKeySelective" parameterType="Mechanism">
		UPDATE tb_mechanism
		<set>
			<if test="mechanismPid != null">
				mechanismPid = #{mechanismPid},
			</if>
			<if test="mechanismName != null">
				mechanismName = #{mechanismName},
			</if>
			<if test="mechanismdDescribe != null">
				mechanismdDescribe = #{mechanismdDescribe},
			</if>
		</set>
		<where>
			mechanismId = #{mechanismId}
		</where>
	</update>


   <!-- 查询机构表的集合数据用来下拉列表的显示 author:czy -->
	<select id="getAllMechanismList" parameterType="Mechanism" resultMap="MechanismMap">
		SELECT
			tb_mechanism.mechanismId,tb_mechanism.mechanismName,tb_mechanism.mechanismdDescribe,
			tb_mechanism.mechanismPid,tb_mechanism.mechanismSort,tb_mechanism.createTime
		FROM
			tb_mechanism
		<where>
		    1=1
			<if test="mechanismPid != null">
				and mechanismPid = #{mechanismPid}
			</if>
			<if test="mechanismId != null">
				and mechanismId = #{mechanismId}
			</if>
		</where>
	</select>

	<!--查询所有Pid为0的机构数据-->
	<select id="getParentMechanismList" parameterType="java.lang.String" resultMap="MechanismMap" >
		SELECT
			mechanismId, mechanismName
		FROM
			tb_mechanism
			<where>
				mechanismPid=#{mechanismPid}
			</where>
	</select>

	<!--查询Pid为某值的所有专业-->
	<select id="getProfessionalByMechanismId" parameterType="java.lang.String" resultMap="MechanismMap">
		SELECT
			mechanismId, mechanismName
		FROM
			tb_mechanism
			<where>
				tb_mechanism.mechanismPid=#{MechanismId}
			</where>
	</select>

	<select id="getMechanismById" parameterType="java.lang.String" resultMap="MechanismMap">
		SELECT
			mechanismName
			FROM
			tb_mechanism
			<where>
				tb_mechanism.mechanismId = #{mechanismId}
			</where>
	</select>

	<!-- 判断机构名称是否存在 author:czy -->
	<select id="getMechanismId" parameterType="Mechanism" resultType="String">
		SELECT
			mechanismId
		FROM
			tb_mechanism
		<where>
			1 = 1
			<if test="mechanismName != null">
				AND mechanismName = #{mechanismName}
			</if>
			<if test="mechanismPid != null">
				AND mechanismPid = #{mechanismPid}
			</if>
		</where>
	</select>
</mapper>
